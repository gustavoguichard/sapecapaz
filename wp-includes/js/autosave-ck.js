function autosave_parse_response(e){var t=wpAjax.parseAjaxResponse(e,"autosave"),n="",r,i;if(t&&t.responses&&t.responses.length){n=t.responses[0].data;if(t.responses[0].supplemental){i=t.responses[0].supplemental;if("disable"==i.disable_autosave){autosave=function(){};autosaveLockRelease=!1;t={errors:!0}}i["active-post-lock"]&&jQuery("#active_post_lock").val(i["active-post-lock"]);if(i.alert){jQuery("#autosave-alert").remove();jQuery("#titlediv").after('<div id="autosave-alert" class="error below-h2"><p>'+i.alert+"</p></div>")}jQuery.each(i,function(e,t){e.match(/^replace-/)&&jQuery("#"+e.replace("replace-","")).val(t)})}if(!t.errors){r=parseInt(t.responses[0].id,10);!isNaN(r)&&r>0&&autosave_update_slug(r)}}n?jQuery(".autosave-message").html(n):autosaveOldMessage&&t&&jQuery(".autosave-message").html(autosaveOldMessage);return t}function autosave_saved(e){blockSave=!1;autosave_parse_response(e);autosave_enable_buttons()}function autosave_saved_new(e){blockSave=!1;var t=autosave_parse_response(e),n;if(t&&t.responses.length&&!t.errors){n=parseInt(t.responses[0].id,10);if(!isNaN(n)&&n>0){notSaved=!1;jQuery("#auto_draft").val("0")}autosave_enable_buttons();if(autosaveDelayPreview){autosaveDelayPreview=!1;doPreview()}}else autosave_enable_buttons()}function autosave_update_slug(e){"undefined"!=makeSlugeditClickable&&jQuery.isFunction(makeSlugeditClickable)&&!jQuery("#edit-slug-box > *").size()&&jQuery.post(ajaxurl,{action:"sample-permalink",post_id:e,new_title:fullscreen&&fullscreen.settings.visible?jQuery("#wp-fullscreen-title").val():jQuery("#title").val(),samplepermalinknonce:jQuery("#samplepermalinknonce").val()},function(e){if(e!=="-1"){jQuery("#edit-slug-box").html(e);makeSlugeditClickable()}})}function autosave_loading(){jQuery(".autosave-message").html(autosaveL10n.savingText)}function autosave_enable_buttons(){setTimeout(function(){jQuery(":button, :submit","#submitpost").removeAttr("disabled");jQuery(".ajax-loading").css("visibility","hidden")},500)}function autosave_disable_buttons(){jQuery(":button, :submit","#submitpost").prop("disabled",!0);setTimeout(autosave_enable_buttons,5e3)}function delayed_autosave(){setTimeout(function(){if(blockSave)return;autosave()},200)}var autosave,autosaveLast="",autosavePeriodical,autosaveOldMessage="",autosaveDelayPreview=!1,notSaved=!0,blockSave=!1,fullscreen,autosaveLockRelease=!0;jQuery(document).ready(function(e){var t=!0;autosaveLast=e("#post #title").val()+e("#post #content").val();autosavePeriodical=e.schedule({time:autosaveL10n.autosaveInterval*1e3,func:function(){autosave()},repeat:!0,protect:!0});e("#post").submit(function(){e.cancel(autosavePeriodical);autosaveLockRelease=!1});e('input[type="submit"], a.submitdelete',"#submitpost").click(function(){blockSave=!0;window.onbeforeunload=null;e(":button, :submit","#submitpost").each(function(){var t=e(this);t.hasClass("button-primary")?t.addClass("button-primary-disabled"):t.addClass("button-disabled")});e(this).attr("id")=="publish"?e("#ajax-loading").css("visibility","visible"):e("#draft-ajax-loading").css("visibility","visible")});window.onbeforeunload=function(){var t=typeof tinyMCE!="undefined"?tinyMCE.activeEditor:!1,n,r;if(t&&!t.isHidden()){if(t.isDirty())return autosaveL10n.saveAlert}else{if(fullscreen&&fullscreen.settings.visible){n=e("#wp-fullscreen-title").val();r=e("#wp_mce_fullscreen").val()}else{n=e("#post #title").val();r=e("#post #content").val()}if((n||r)&&n+r!=autosaveLast)return autosaveL10n.saveAlert}};e(window).unload(function(t){if(!autosaveLockRelease)return;if(t.target&&t.target.nodeName!="#document")return;e.ajax({type:"POST",url:ajaxurl,async:!1,data:{action:"wp-remove-post-lock",_wpnonce:e("#_wpnonce").val(),post_ID:e("#post_ID").val(),active_post_lock:e("#active_post_lock").val()}})});e("#post-preview").click(function(){if(e("#auto_draft").val()=="1"&&notSaved){autosaveDelayPreview=!0;autosave();return!1}doPreview();return!1});doPreview=function(){e("input#wp-preview").val("dopreview");e("form#post").attr("target","wp-preview").submit().attr("target","");e.browser.safari&&e("form#post").attr("action",function(e,t){return t+"?t="+(new Date).getTime()});e("input#wp-preview").val("")};typeof tinyMCE!="undefined"&&e("#title")[e.browser.opera?"keypress":"keydown"](function(n){if(n.which==9&&!n.shiftKey&&!n.controlKey&&!n.altKey){e("#auto_draft").val()=="1"&&e("#title").val().length>0&&autosave();if(tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden()&&t){n.preventDefault();t=!1;tinyMCE.activeEditor.focus();return!1}}});"1"==e("#auto_draft").val()&&e("#title").blur(function(){if(!this.value||e("#auto_draft").val()!="1")return;delayed_autosave()})});autosave=function(){blockSave=!0;var e=typeof tinyMCE!="undefined"&&tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden(),t,n,r,i,s;autosave_disable_buttons();t={action:"autosave",post_ID:jQuery("#post_ID").val()||0,autosavenonce:jQuery("#autosavenonce").val(),post_type:jQuery("#post_type").val()||"",autosave:1};jQuery(".tags-input").each(function(){t[this.name]=this.value});n=!0;jQuery("#TB_window").css("display")=="block"&&(n=!1);if(e&&n){r=tinyMCE.activeEditor;if(r.plugins.spellchecker&&r.plugins.spellchecker.active)n=!1;else{("mce_fullscreen"==r.id||"wp_mce_fullscreen"==r.id)&&tinyMCE.get("content").setContent(r.getContent({format:"raw"}),{format:"raw"});tinyMCE.triggerSave()}}if(fullscreen&&fullscreen.settings.visible){t.post_title=jQuery("#wp-fullscreen-title").val()||"";t.content=jQuery("#wp_mce_fullscreen").val()||""}else{t.post_title=jQuery("#title").val()||"";t.content=jQuery("#content").val()||""}jQuery("#post_name").val()&&(t.post_name=jQuery("#post_name").val());if(t.post_title.length==0&&t.content.length==0||t.post_title+t.content==autosaveLast)n=!1;i=jQuery("#original_post_status").val();goodcats=[];jQuery("[name='post_category[]']:checked").each(function(e){goodcats.push(this.value)});t.catslist=goodcats.join(",");jQuery("#comment_status").prop("checked")&&(t.comment_status="open");jQuery("#ping_status").prop("checked")&&(t.ping_status="open");jQuery("#excerpt").size()&&(t.excerpt=jQuery("#excerpt").val());jQuery("#post_author").size()&&(t.post_author=jQuery("#post_author").val());jQuery("#parent_id").val()&&(t.parent_id=jQuery("#parent_id").val());t.user_ID=jQuery("#user-id").val();jQuery("#auto_draft").val()=="1"&&(t.auto_draft="1");if(n){autosaveLast=t.post_title+t.content;jQuery(document).triggerHandler("wpcountwords",[t.content])}else t.autosave=0;t.auto_draft=="1"?s=autosave_saved_new:s=autosave_saved;autosaveOldMessage=jQuery("#autosave").html();jQuery.ajax({data:t,beforeSend:n?autosave_loading:null,type:"POST",url:ajaxurl,success:s})};