(function(e){e.suggest=function(t,n){function c(){var e=r.offset();i.css({top:e.top+t.offsetHeight+"px",left:e.left+"px"})}function h(e){if(/27$|38$|40$/.test(e.keyCode)&&i.is(":visible")||/^13$|^9$/.test(e.keyCode)&&y()){e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation();e.cancelBubble=!0;e.returnValue=!1;switch(e.keyCode){case 38:E();break;case 40:w();break;case 9:case 13:b();break;case 27:i.hide()}}else if(r.val().length!=o){s&&clearTimeout(s);s=setTimeout(p,n.delay);o=r.val().length}}function p(){var t=e.trim(r.val()),s,o;if(n.multiple){s=t.lastIndexOf(n.multipleSep);s!=-1&&(t=e.trim(t.substr(s+n.multipleSep.length)))}if(t.length>=n.minchars){cached=d(t);cached?m(cached.items):e.get(n.source,{q:t},function(e){i.hide();o=g(e,t);m(o);v(t,o,e.length)})}else i.hide()}function d(e){var t;for(t=0;t<u.length;t++)if(u[t]["q"]==e){u.unshift(u.splice(t,1)[0]);return u[0]}return!1}function v(e,t,r){var i;while(u.length&&f+r>n.maxCacheSize){i=u.pop();f-=i.size}u.push({q:e,size:r,items:t});f+=r}function m(t){var r="",s;if(!t)return;if(!t.length){i.hide();return}c();for(s=0;s<t.length;s++)r+="<li>"+t[s]+"</li>";i.html(r).show();i.children("li").mouseover(function(){i.children("li").removeClass(n.selectClass);e(this).addClass(n.selectClass)}).click(function(e){e.preventDefault();e.stopPropagation();b()})}function g(t,r){var i=[],s=t.split(n.delimiter),o,u;for(o=0;o<s.length;o++){u=e.trim(s[o]);if(u){u=u.replace(new RegExp(r,"ig"),function(e){return'<span class="'+n.matchClass+'">'+e+"</span>"});i[i.length]=u}}return i}function y(){var e;if(!i.is(":visible"))return!1;e=i.children("li."+n.selectClass);e.length||(e=!1);return e}function b(){$currentResult=y();if($currentResult){if(n.multiple){r.val().indexOf(n.multipleSep)!=-1?$currentVal=r.val().substr(0,r.val().lastIndexOf(n.multipleSep)+n.multipleSep.length):$currentVal="";r.val($currentVal+$currentResult.text()+n.multipleSep);r.focus()}else r.val($currentResult.text());i.hide();n.onSelect&&n.onSelect.apply(r[0])}}function w(){$currentResult=y();$currentResult?$currentResult.removeClass(n.selectClass).next().addClass(n.selectClass):i.children("li:first-child").addClass(n.selectClass)}function E(){var e=y();e?e.removeClass(n.selectClass).prev().addClass(n.selectClass):i.children("li:last-child").addClass(n.selectClass)}var r,i,s,o,u,f;r=e(t).attr("autocomplete","off");i=e(document.createElement("ul"));s=!1;o=0;u=[];f=0;i.addClass(n.resultsClass).appendTo("body");c();e(window).load(c).resize(c);r.blur(function(){setTimeout(function(){i.hide()},200)});if(e.browser.msie)try{i.bgiframe()}catch(l){}e.browser.mozilla?r.keypress(h):r.keydown(h)};e.fn.suggest=function(t,n){if(!t)return;n=n||{};n.multiple=n.multiple||!1;n.multipleSep=n.multipleSep||", ";n.source=t;n.delay=n.delay||100;n.resultsClass=n.resultsClass||"ac_results";n.selectClass=n.selectClass||"ac_over";n.matchClass=n.matchClass||"ac_match";n.minchars=n.minchars||2;n.delimiter=n.delimiter||"\n";n.onSelect=n.onSelect||!1;n.maxCacheSize=n.maxCacheSize||65536;this.each(function(){new e.suggest(this,n)});return this}})(jQuery);