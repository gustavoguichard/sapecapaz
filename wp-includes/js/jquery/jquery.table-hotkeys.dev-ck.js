(function(e){e.fn.filter_visible=function(t){t=t||3;var n=function(){var n=e(this),r;for(r=0;r<t-1;++r){if(!n.is(":visible"))return!1;n=n.parent()}return!0};return this.filter(n)};e.table_hotkeys=function(t,n,r){r=e.extend(e.table_hotkeys.defaults,r);var i,s,o,u,a,f,l,c,h,p,d,v,m;i=r.class_prefix+r.selected_suffix;s=r.class_prefix+r.destructive_suffix;o=function(t){e.table_hotkeys.current_row&&e.table_hotkeys.current_row.removeClass(i);t.addClass(i);t[0].scrollIntoView(!1);e.table_hotkeys.current_row=t};u=function(t){!f(t)&&e.isFunction(r[t+"_page_link_cb"])&&r[t+"_page_link_cb"]()};a=function(t){var n,i;if(!e.table_hotkeys.current_row){n=p();e.table_hotkeys.current_row=n;return n[0]}i="prev"==t?e.fn.prevAll:e.fn.nextAll;return i.call(e.table_hotkeys.current_row,r.cycle_expr).filter_visible()[0]};f=function(t){var n=a(t);if(!n)return!1;o(e(n));return!0};l=function(){return f("prev")};c=function(){return f("next")};h=function(){e(r.checkbox_expr,e.table_hotkeys.current_row).each(function(){this.checked=!this.checked})};p=function(){return e(r.cycle_expr,t).filter_visible().eq(r.start_row_index)};d=function(){var n=e(r.cycle_expr,t).filter_visible();return n.eq(n.length-1)};v=function(t){return function(){if(null==e.table_hotkeys.current_row)return!1;var n=e(t,e.table_hotkeys.current_row);if(!n.length)return!1;n.is("."+s)&&(c()||l());n.click()}};m=p();if(!m.length)return;r.highlight_first?o(m):r.highlight_last&&o(d());e.hotkeys.add(r.prev_key,r.hotkeys_opts,function(){return u("prev")});e.hotkeys.add(r.next_key,r.hotkeys_opts,function(){return u("next")});e.hotkeys.add(r.mark_key,r.hotkeys_opts,h);e.each(n,function(){var t,n;if(e.isFunction(this[1])){t=this[1];n=this[0];e.hotkeys.add(n,r.hotkeys_opts,function(n){return t(n,e.table_hotkeys.current_row)})}else{n=this;e.hotkeys.add(n,r.hotkeys_opts,v("."+r.class_prefix+n))}})};e.table_hotkeys.current_row=null;e.table_hotkeys.defaults={cycle_expr:"tr",class_prefix:"vim-",selected_suffix:"current",destructive_suffix:"destructive",hotkeys_opts:{disableInInput:!0,type:"keypress"},checkbox_expr:":checkbox",next_key:"j",prev_key:"k",mark_key:"x",start_row_index:2,highlight_first:!1,highlight_last:!1,next_page_link_cb:!1,prev_page_link_cb:!1}})(jQuery);