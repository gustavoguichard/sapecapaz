(function(){function t(e){return document.getElementById(e)}function n(e){var t,r,i,s;if(null==e||"object"!=typeof e)return e;if("length"in e){i=[];for(t=0,r=e.length;t<r;++t)i[t]=n(e[t]);return i}i={};for(s in e)e.hasOwnProperty(s)&&(i[s]=n(e[s]));return i}function r(e){var n=t(e);return n.nodeName=="SELECT"?n.options[n.selectedIndex].value:n.type=="checkbox"?n.checked:n.value}function i(e,n,r){if(typeof n!="undefined"&&n!=null){var i=t(e);if(i.nodeName=="SELECT")selectByValue(document.forms[0],e,n);else if(i.type=="checkbox"){if(typeof n=="string"){n=n.toLowerCase();n=!r&&n==="true"||r&&n===r.toLowerCase()}i.checked=!!n}else i.value=n}}var e;(e=tinyMCEPopup.getParam("media_external_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(e)+'"></script>');window.Media={init:function(){var e,r,i=this;i.editor=r=tinyMCEPopup.editor;t("filebrowsercontainer").innerHTML=getBrowserHTML("filebrowser","src","media","media");t("qtsrcfilebrowsercontainer").innerHTML=getBrowserHTML("qtsrcfilebrowser","quicktime_qtsrc","media","media");t("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");t("video_altsource1_filebrowser").innerHTML=getBrowserHTML("video_filebrowser_altsource1","video_altsource1","media","media");t("video_altsource2_filebrowser").innerHTML=getBrowserHTML("video_filebrowser_altsource2","video_altsource2","media","media");t("audio_altsource1_filebrowser").innerHTML=getBrowserHTML("audio_filebrowser_altsource1","audio_altsource1","media","media");t("audio_altsource2_filebrowser").innerHTML=getBrowserHTML("audio_filebrowser_altsource2","audio_altsource2","media","media");t("video_poster_filebrowser").innerHTML=getBrowserHTML("filebrowser_poster","video_poster","media","image");e=i.getMediaListHTML("medialist","src","media","media");e==""?t("linklistrow").style.display="none":t("linklistcontainer").innerHTML=e;isVisible("filebrowser")&&(t("src").style.width="230px");isVisible("video_filebrowser_altsource1")&&(t("video_altsource1").style.width="220px");isVisible("video_filebrowser_altsource2")&&(t("video_altsource2").style.width="220px");isVisible("audio_filebrowser_altsource1")&&(t("audio_altsource1").style.width="220px");isVisible("audio_filebrowser_altsource2")&&(t("audio_altsource2").style.width="220px");isVisible("filebrowser_poster")&&(t("video_poster").style.width="220px");r.dom.setOuterHTML(t("media_type"),i.getMediaTypeHTML(r));i.setDefaultDialogSettings(r);i.data=n(tinyMCEPopup.getWindowArg("data"));i.dataToForm();i.preview();updateColor("bgcolor_pick","bgcolor")},insert:function(){var e=tinyMCEPopup.editor;this.formToData();e.execCommand("mceRepaint");tinyMCEPopup.restoreSelection();e.selection.setNode(e.plugins.media.dataToImg(this.data));tinyMCEPopup.close()},preview:function(){t("prev").innerHTML=this.editor.plugins.media.dataToHtml(this.data,!0)},moveStates:function(e,n){function h(e){var t={};e&&tinymce.each(e.split("&"),function(e){var n=e.split("=");t[unescape(n[0])]=unescape(n[1])});return t}function p(t,n){var o,u,a,f,l;if(t==s.type||t=="global"){n=tinymce.explode(n);for(o=0;o<n.length;o++){u=n[o];a=t=="global"?u:t+"_"+u;if(t=="global")l=s;else if(t=="video"||t=="audio"){l=s.video.attrs;!l&&!e&&(s.video.attrs=l={})}else l=s.params;if(l)if(e)i(a,l[u],t=="video"||t=="audio"?u:"");else{delete l[u];f=r(a);(t=="video"||t=="audio")&&f===!0&&(f=u);if(c[a]){if(f!==c[a]){f=""+f;l[u]=f}}else if(f){f=""+f;l[u]=f}}}}}var s=this.data,o=this.editor,u=o.plugins.media,a,f,l,c,f;c={quicktime_autoplay:!0,quicktime_controller:!0,flash_play:!0,flash_loop:!0,flash_menu:!0,windowsmedia_autostart:!0,windowsmedia_enablecontextmenu:!0,windowsmedia_invokeurls:!0,realmedia_autogotourl:!0,realmedia_imagestatus:!0};if(!e){s.type=t("media_type").options[t("media_type").selectedIndex].value;s.width=r("width");s.height=r("height");f=r("src");if(n=="src"){a=f.replace(/^.*\.([^.]+)$/,"$1");if(l=u.getType(a))s.type=l.name.toLowerCase();i("media_type",s.type)}if(s.type=="video"||s.type=="audio"){s.video.sources||(s.video.sources=[]);s.video.sources[0]={src:r("src")}}}t("video_options").style.display="none";t("audio_options").style.display="none";t("flash_options").style.display="none";t("quicktime_options").style.display="none";t("shockwave_options").style.display="none";t("windowsmedia_options").style.display="none";t("realmedia_options").style.display="none";t("embeddedaudio_options").style.display="none";t(s.type+"_options")&&(t(s.type+"_options").style.display="block");i("media_type",s.type);p("flash","play,loop,menu,swliveconnect,quality,scale,salign,wmode,base,flashvars");p("quicktime","loop,autoplay,cache,controller,correction,enablejavascript,kioskmode,autohref,playeveryframe,targetcache,scale,starttime,endtime,target,qtsrcchokespeed,volume,qtsrc");p("shockwave","sound,progress,autostart,swliveconnect,swvolume,swstretchstyle,swstretchhalign,swstretchvalign");p("windowsmedia","autostart,enabled,enablecontextmenu,fullscreen,invokeurls,mute,stretchtofit,windowlessvideo,balance,baseurl,captioningid,currentmarker,currentposition,defaultframe,playcount,rate,uimode,volume");p("realmedia","autostart,loop,autogotourl,center,imagestatus,maintainaspect,nojava,prefetch,shuffle,console,controls,numloop,scriptcallbacks");p("video","poster,autoplay,loop,muted,preload,controls");p("audio","autoplay,loop,preload,controls");p("embeddedaudio","autoplay,loop,controls");p("global","id,name,vspace,hspace,bgcolor,align,width,height");if(e)if(s.type=="video"){s.video.sources[0]&&i("src",s.video.sources[0].src);f=s.video.sources[1];f&&i("video_altsource1",f.src);f=s.video.sources[2];f&&i("video_altsource2",f.src)}else if(s.type=="audio"){s.video.sources[0]&&i("src",s.video.sources[0].src);f=s.video.sources[1];f&&i("audio_altsource1",f.src);f=s.video.sources[2];f&&i("audio_altsource2",f.src)}else{s.type=="flash"&&tinymce.each(o.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"}),function(e,t){e=="$url"&&(s.params.src=h(s.params.flashvars)[t]||s.params.src||"")});i("src",s.params.src)}else{f=r("src");if(f.match(/youtu.be\/[a-z1-9.-_]+/)){s.width=425;s.height=350;s.params.frameborder="0";s.type="iframe";f="http://www.youtube.com/embed/"+f.match(/youtu.be\/([a-z1-9.-_]+)/)[1];i("src",f);i("media_type",s.type)}if(f.match(/youtube.com(.+)v=([^&]+)/)){s.width=425;s.height=350;s.params.frameborder="0";s.type="iframe";f="http://www.youtube.com/embed/"+f.match(/v=([^&]+)/)[1];i("src",f);i("media_type",s.type)}if(f.match(/video.google.com(.+)docid=([^&]+)/)){s.width=425;s.height=326;s.type="flash";f="http://video.google.com/googleplayer.swf?docId="+f.match(/docid=([^&]+)/)[1]+"&hl=en";i("src",f);i("media_type",s.type)}if(s.type=="video"){s.video.sources||(s.video.sources=[]);s.video.sources[0]={src:f};f=r("video_altsource1");f&&(s.video.sources[1]={src:f});f=r("video_altsource2");f&&(s.video.sources[2]={src:f})}else if(s.type=="audio"){s.video.sources||(s.video.sources=[]);s.video.sources[0]={src:f};f=r("audio_altsource1");f&&(s.video.sources[1]={src:f});f=r("audio_altsource2");f&&(s.video.sources[2]={src:f})}else s.params.src=f;i("width",s.width||(s.type=="audio"?300:320));i("height",s.height||(s.type=="audio"?32:240))}},dataToForm:function(){this.moveStates(!0)},formToData:function(e){(e=="width"||e=="height")&&this.changeSize(e);if(e=="source"){this.moveStates(!1,e);i("source",this.editor.plugins.media.dataToHtml(this.data));this.panel="source"}else{if(this.panel=="source"){this.data=n(this.editor.plugins.media.htmlToData(r("source")));this.dataToForm();this.panel=""}this.moveStates(!1,e);this.preview()}},beforeResize:function(){this.width=parseInt(r("width")||(this.data.type=="audio"?"300":"320"),10);this.height=parseInt(r("height")||(this.data.type=="audio"?"32":"240"),10)},changeSize:function(e){var n,s,o,u;if(t("constrain").checked){n=parseInt(r("width")||(this.data.type=="audio"?"300":"320"),10);s=parseInt(r("height")||(this.data.type=="audio"?"32":"240"),10);if(e=="width"){this.height=Math.round(n/this.width*s);i("height",this.height)}else{this.width=Math.round(s/this.height*n);i("width",this.width)}}},getMediaListHTML:function(){if(typeof tinyMCEMediaList!="undefined"&&tinyMCEMediaList.length>0){var e="";e+='<select id="linklist" name="linklist" style="width: 250px" onchange="this.form.src.value=this.options[this.selectedIndex].value;Media.formToData(\'src\');">';e+='<option value="">---</option>';for(var t=0;t<tinyMCEMediaList.length;t++)e+='<option value="'+tinyMCEMediaList[t][1]+'">'+tinyMCEMediaList[t][0]+"</option>";e+="</select>";return e}return""},getMediaTypeHTML:function(e){function t(t,n){return e.schema.getElementRule(n||t)?'<option value="'+t+'">'+tinyMCEPopup.editor.translate("media_dlg."+t)+"</option>":""}var n="";n+='<select id="media_type" name="media_type" onchange="Media.formToData(\'type\');">';n+=t("video");n+=t("audio");n+=t("flash","object");n+=t("quicktime","object");n+=t("shockwave","object");n+=t("windowsmedia","object");n+=t("realmedia","object");n+=t("iframe");e.getParam("media_embedded_audio",!1)&&(n+=t("embeddedaudio","object"));n+="</select>";return n},setDefaultDialogSettings:function(e){var t=e.getParam("media_dialog_defaults",{});tinymce.each(t,function(e,t){i(t,e)})}};tinyMCEPopup.requireLangPack();tinyMCEPopup.onInit.add(function(){Media.init()})})();